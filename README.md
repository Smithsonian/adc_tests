ADC5G Testing
=============
This repository contains scripts and bitcodes for testing the 
ASIAA 5 GSps ADC (https://casper.berkeley.edu/wiki/ADC1x5000-8) 
on ROACH1 and ROACH2.

Requirements
------------
* Python >= 2.6
* numpy >= 1.6.1 (only for the 'array' object)
* corr >= 0.6.9 (only for katcp_wrapper.FpgaClient)

Getting Started
---------------
Begin with connecting to your ROACH and programming it:
```python
import corr
roach = corr.katcp_wrapper.FpgaClient(host, port)
roach.is_connected() # should return True
roach.progdev(bitcode)
```

Calibrating data-to-clk
-----------------------
Glitches may occur if the rising-edge of the iSerDes capture clock 
(which is generated by a PLL locked to the externally provided ADC clock) 
does not occur within the data "eye", which can occur due to routing delays 
or component delays. Luckily the e2v EV8AQ160 provides a ramp test-vector 
which can be used to detect these glitches. The phase-relation of the 
input/capture clocks can then be adjusted until these glitches disappear. 
The 'adc5g' package provides a function for doing so:
```python
import adc5g
optimal_ps_0, glitches_0 = adc5g.calibrate_mmcm_phase(roach, 0, 'raw_0')
optimal_ps_1, glitches_1 = adc5g.calibrate_mmcm_phase(roach, 1, 'raw_1')
```
The calibration steps through all 56 phases and attempts to find the 
optimal one, i.e. the one with zero glitches furthest away from the peak. 
The function returns the optimal phase it found and an array containing 
the number of glitches detected in the ramp at each phase step.

